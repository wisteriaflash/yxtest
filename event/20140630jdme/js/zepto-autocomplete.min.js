(function(b){var a={init:function(o){var d=b.extend({data:[],container:null,dataSource:null,sortProp:"",customStyle:false,height:20,maxOptions:100,scrollable:true,optionBackground:"#FFFFFF",currentBackground:"#EBE1E5",select:null,itemTpl:""},o);var k=this;var f=k[0].externalData;var j=null;if(!f){e();return k.each(function(){k.bind("input paste",g);});}function e(){var r=b('<div class="autocomplete">');var q=b("body");if(d.container){q=d.container;}q.append(r);if(!d.customStyle){var p={left:k.offset().left,top:k.offset().top+k.height()};r.width(k.width()-2);r.css({zIndex:1000,position:"absolute",top:p.top,left:p.left,border:"1px solid #000",background:"#FFF"});r.css("max-height",d.maxOptions*d.height+"px");}k.attr("data-autocomplete","true");r.on("mousedown.autocomplete",".record",n);if(d.scrollable){r.css("overflow","auto");}else{r.css("overflow","hidden");}k[0].externalData={storage:r,settings:d};r.hide();}function n(q){k.val(b(q.target).text());var p=k[0].externalData.settings;p.select&&p.select(q);}function l(){var p=k[0].externalData.settings;var q=k.val();if(p.dataSource){p.dataSource(q,m);}else{m();}}function m(r){var v=k[0].externalData.storage;var p=k[0].externalData.settings;var u=p.sortProp;var x=k.val();console.log(x);if(b.isArray(r)){p.data=r;}v.empty();v.hide();if(u.length>0){function y(C,A){var D=C[u].toLowerCase();var B=A[u].toLowerCase();return((D<B)?-1:((D>B)?1:0));}p.data.sort(y);}else{p.data.sort();}var z,t;for(var q=0;q<p.data.length;q++){z=p.data[q];if(u.length>0){t=z[u];}else{t=p.data[q];}if(t.toLowerCase().indexOf(x.toLowerCase())!=-1&&x){var w=z.link?z.link:"javascript:;";var s=b('<div class="record">'+t+"</div>");if(p.itemTpl.length>0){s=i(p.itemTpl,z);}v.append(s);}}if(v.find(".record").length){j=v.find(".record:first-child");j.css("background",p.currentBackground);}v.show();}function i(q,r){var p=q.replace(/{{(.*?)}}/igm,function(t,s){return r[s]?r[s]:t;});return b(p);}function h(p){var q=k[0].externalData.storage;if(j.prev().length){if(p){q[0].scrollTop-=d.height;}j.css("background",d.optionBackground);j=j.prev();j.css("background",d.currentBackground);}}function c(p){var q=k[0].externalData.storage;if(j.next().length){if(p){q[0].scrollTop+=d.height;}j.css("background",d.optionBackground);j=j.next();j.css("background",d.currentBackground);}}function g(t){var u=k[0].externalData.storage;var r=k[0].externalData.settings;switch(t.keyCode){case 37:break;case 39:break;case 38:var s=j.index()-1;if(!r.scrollable){h();}else{var p=false;if(s<u[0].scrollTop/r.height){p=true;}h(p);}break;case 40:var q=j.index()+1;if(!r.scrollable){if(q<r.maxOptions){c();}}else{var p=false;if(q>=r.maxOptions){p=true;}c(p);}break;case 13:if(u.width()){k.val(j.html());u.empty();u.hide();}break;default:l();break;}}},destroy:function(){return this.each(function(){$this=b(this);$this.unbind(".autocomplete");var c=this.externalData.storage;b(c).remove();delete this.externalData;});},add:function(e){$this=this;function f(g){var j={};for(var h=0;h<g.length;h++){var k=g[h];j[k]=true;}return Object.keys(j);}if(Object.prototype.toString.call(e)!="[object Array]"){e=[e];}var c=$this[0].externalData.settings.data.concat(e);c=f(c);var d=$this[0].externalData;d.settings.data=c.sort();if(d.settings.maxOptions>d.settings.data.length){d.storage.css("max-height",d.settings.data.length*d.settings.height+"px");}else{d.storage.css("max-height",d.settings.maxOptions*d.settings.height+"px");}},clean:function(){$this=this;var c=$this[0].externalData.storage;c[0].scrollTop=0;c.hide();$this.val("");}};b.fn.autoComplete=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments);}else{b.error("Method named "+c+" does not exist Zepto.autocomplete");}}};})(Zepto);